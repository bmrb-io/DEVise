<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>BMRB visualization software overview</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-11">
    <META name="Author" content="wenger@cs.wisc.edu (Kent Wenger)">
    <META name="Description" content="BMRB internal website">
    <link REL="stylesheet" TYPE="text/css" HREF="/stylesheets/main.css" TITLE="main stylesheet">
</HEAD>
<BODY>

<center><h2>
BMRB visualization software overview
</h2></center>


<center><h3>
Components
</h3></center>
<p>
The BMRB data visualization system consists of the following four
main components:
</p>
<ul>
<li>DEVise
<li>JavaScreen
<li>Peptide-CGI
<li>ChemShift
</ul>

<h4>
DEVise
</h4>

<p>
DEVise (Data Exploration and Visualization) is an interactive
visualization tool that lets users easily browse visual presentations
of large tabular datasets.  However, DEVise itself is based on the
X Windows system, so it is not web-compatible.  Also, creating new
visualizations in DEVise is not as easy as we had initially hoped.
Therefore, we have combined DEVise with other pieces of software to
make it useful as a web-based visualization tool.
</p>

<p>
DEVise basically enables data records to get translated to symbols
that are displayed on the screen (in what we call a "view").  The
power of DEVise comes mainly from interconnections between various
views.  (For more details on this, see the paper
<a href="http://pages.cs.wisc.edu/~devise/devise/spie2000_hongyu.ps.gz">
"DEVise and the JavaScreen: Visualization on the Web"</a>.)
</p>

<p>
For the point of this document, the most important thing is that 
a DEVise visualization consists of a session file, and a number of
associated data and schema files.  The session file basically defines
how the data is displayed, and the connections between views.  Data
files are ASCII (in the case of all BMRB data) files that have a
uniform format for all records within a given file.  Schema files
specify the formats of the data files.
</p>

<p>
There is also a data source catalog that maps logical data names
(referred to in the session file) to a physical data file name
and associated schema.  DEVise is run with an "overall" data catalog,
but the BMRB session files are configured to have their own internal
data catalogs (this is much simpler and cleaner than trying to add
all of the relevant data to the overall catalog on the fly).
</p>

<p>
There is more detailed information about DEVise at the
<a href="http://pages.cs.wisc.edu/~devise">DEVise home page</a>.
</p>


<h4>
JavaScreen
</h4>

<p>
The JavaScreen enables DEVise to operate on the web.  The
JavaScreen setup consists of three main parts: the JavaScreen client,
the JavaScreen Point of Presence (JSPoP) and one or more DEVised
servers.
</p>

<p>
When the user performs some action in the JavaScreen client, the client
sends a command to the JSPoP, which then forwards the command to a
DEVised.  The DEVised processes the client command, and then sends
commands (and possibly images and data) to the JSPoP, which forwards
them to the JavaScreen client.  The JavaScreen commands are documented
in the Java/JavaScreen/doc/commands file.  The set of commands has
a protocol version which must match between the JavaScreen client,
JSPoP, and DEVised.
</p>

<p>
The DEVised creates images for each DEVise view, and sends these images
to the JavaScreen client.  The DEVised creates the images using Xfvb
(X virtual frame buffer) as an X server.  In addition, some views are
configured to send actual DEVise GData records to the JavaScreen
(the images sent for these views contain a blank data area that is
just colored with the view background color).  Some text views are
configured to send data, because rendering text in the client produces
higher-quality images.  In addition, all 3D views are configured to
send data to the client, because the DEVise server has only a limited
3D capability.  The JavaScreen client currently uses Jmol
(http://jmol.sourceforge.net/) to render the 3D structures.
</p>

<p>
<a href="js_commands.txt">JavaScreen commands</a>
</p>

<p>
<a href="js_client_doc.txt">JavaScreen client concepts</a>
</p>

<p>
<a href="jspop_doc.txt">JSPoP concepts</a>
</p>

<p>
<a href="jss_doc.txt">JSS concepts</a>
</p>


<h4>
Peptide-CGI
</h4>

<p>
Peptide-CGI is responsible for translating a BMRB entry into
a set of DEVise visualizations.  It uses STARlibJ to parse the NMR-STAR
file, and extracts various data sets from the file, writing them out
as DEVise-compatible data files.  Peptide-CGI also writes the associated
DEVise session files, and an html file for each visualization, plus
a summary html file with links to each visualization available for an
entry.  (Note that the set of available visualizations differs
depending on the exact data in the entry.)  The schema files used
to parse the data files are also part of the Peptide-CGI source code.
</p>

<p>
The Peptide-CGI source code also includes the session, schema, and html
files for the BMRB database-wide histogram visualizations (but not
the data files).
</p>

<p>
Peptide-CGI is also used by the visualization server interface, which
allows users to upload and visualize NMR data.  Basically, the only
difference between the visualization server and the "normal"
visualizations accessed via the NMR Browser is that the user's
uploaded file is visualized, instead of a BMRB entry.
</p>

<p>
<a href="peptide-cgi_concepts.txt">Peptide-CGI concepts</a>
</p>


<h4>
ChemShift
</h4>

<p>
ChemShift is a Java program, based on earlier Tcl scripts
developed by Gabriel Cornilescu, that calculates differences between
actual and predicted chemical shift values.  It uses MOLMOL and
NMRPipe to do parts of the calculation.  ChemShift is run by Peptide-CGI
when necessary, and generates output files that can be read by
DEVise.  ChemShift now actually incorporates the Peptide-CGI jar file,
because it uses Peptide-CGI code to do the high-level parsing of
NMR-STAR files.  This replaced some buggy separate parsing code
that ChemShift used to have; it also means that ChemShift automatically
picks up all of the 2.1/3.1 code in Peptide-CGI.
</p>


<center><h3>
Control and Data Flow
</h3></center>

<p>When the user clicks the "Data Visualizations" link in the NMR Browser,
the following steps are performed:</p>
<ol>
<li>The browser sends the BMRB accession number to the make_view script
in the CGI directory.
<li>Make_view runs s2d, which runs the Peptide-CGI Java code.
<li>Peptide-CGI checks whether there are cached visualizations, and
if so, if they are newer than the modification date on the BMRB entry.
If so, it simply uses the cached visualizations; otherwise, it continues
to the next step.
<li>Peptide-CGI writes the summary html page for the entry, which has
links to all of the visualizations available.  It also writes DEVise
session and data files for the visualizations, and an html file
that loads the JavaScreen client and passes it the session name for
the appropriate visualization.
</ol>

<p>
When the overall set of visualizations for an entry is generated, the
3D structure and chemical shift referencing visualizations are not
generated, because they are more calculation-intensive and require
files from the PDB web site.  Instead, links are inserted into the
summary html file that re-run make view with a new set of parameters:
</p>
<ol>
<li>The browser sends the BMRB accession number, PDB entry ID, and
other information to the make_view script.
<li>Make_view runs s2d, which runs the Peptide-CGI Java code.
<li>Peptide-CGI gets the relevant PDB entry for a structure visualization,
or runs ChemShift on the BMRB and PDB entries for a chemical shift
reference visualization.
<li>Peptide-CGI writes the appropriate DEVise session and data files
(chemical shift reference data files are written by ChemShift) and the
visualization-specific html file.
</ol>

<p>
When the user clicks on the link to any specific visualization
page, the following happens (after the steps above, if the visualization
is of a 3D structure or chemical shift references):
</p>
<ol>
<li>The browser loads the JavaScreen client, with the session file
name specified as an applet parameter.
<li>The JavaScreen client connects to the JSPoP running on the
web server machine, and sends a command requesting that the specified
session be opened.
<li>The JSPoP forwards the commands to the DEVised, which opens the
session, and sends back commands, images, and possibly data.
<li>The JavaScreen client receives the commands, images, and data,
and displays the images and data in its window.
</ol>






<center><h3>
Diagrams
</h3></center>

<p>
<a href="dataflow_overview.jpg">Data flow overview</a>
</p>

<p>
<a href="peptide-cgi_dataflow.jpg">Peptide-CGI data flow</a>
</p>

<p>
<a href="chem_shift_dataflow.jpg">ChemShift data flow</a>
</p>

<p>
<a href="JavaScreen.jpg">JavaScreen components</a>
</p>

<p>
<a href="new_visualization.jpg">Procedure for creating a new
visualization</a>
</p>


<center><h3>
Logistics
</h3></center>

<h4>
DEVise
</h4>

<table border="1" cellspacing="0" cellpadding="2">
  <tr>
    <td>CVS repository:</td>
    <td>/p/devise/cvs at computer sciences</td>
  </tr>
  <tr>
    <td>Programming language:</td>
    <td>C++ (most recently compiled with gcc 4.3.0)</td>
  </tr>
  <tr>
    <td>Development installation:</td>
    <td>various workspaces at computer sciences</td>
  </tr>
  <tr>
    <td>Quality assurance installation:</td>
    <td>/afs/cs.wisc.edu/p/devise/release/;
      <p>manatee.bmrb.wisc.edu:/website/devise (user web)</td>
  </tr>
  <tr>
    <td>Production installations:</td>
    <td>pacu.bmrb.wisc.edu:/website/devise (user web);
      <p>piranha.bmrb.wisc.edu:/website/devise (user web);
      <p>bmrbweb.protein.osaka-u.ac.jp:/bmrb/devise (user webmaster);
      <p>bmrb.cerm.unifi.it:/bmrb/devise (user bmrb)</td>
  </tr>
</table>

<h4>
JavaScreen
</h4>
<table border="1" cellspacing="0" cellpadding="2">
  <tr>
    <td>CVS repository:</td>
    <td>/p/devise/cvs at computer sciences</td>
  </tr>
  <tr>
    <td>Programming language:</td>
    <td>Java (most recently compiled with 1.6.0_07; generates 1.3
      class files)</td>
  </tr>
  <tr>
    <td>Development installation:</td>
    <td>various workspaces at computer sciences</td>
  </tr>
  <tr>
    <td>Quality assurance installation:</td>
    <td>teal.cs.wisc.edu:/scratch/devise/js.regular (user devise) (see
      Makefile.config.uw_cs);
      manatee.bmrb.wisc.edu:/website/devise/js.installed (user web) (see
      Makefile.config.bmrb_manatee)</td>
  </tr>
  <tr>
    <td>Production installations:</td>
    <td>pacu.bmrb.wisc.edu:/website/devise/js.installed (user web)
      (see pacu.bmrb.wisc.edu:/website/devise/JavaScreen-*,
      Makefile.config.bmrb_pacu);
      <p>piranha.bmrb.wisc.edu:/website/devise/js.installed (user web)
      (see piranha.bmrb.wisc.edu:/website/devise/JavaScreen-*,
      Makefile.config.bmrb_piranha);
      <p>bmrbweb.protein.osaka-u.ac.jp:/bmrb/devise_installed/js.installed
      (user webmaster)
      (see bmrbweb.protein.osaka-u.ac.jp:/bmrb/devise/JavaScreen-*,
      Makefile.config.osaka2);
      <p>bmrb.cerm.unifi.it:/bmrb/devise/installed/js (user bmrb)
      (see bmrb.postgenomicnmr.net:/bmrb/devise/JavaScreen-*,
      Makefile.config.florence)</td>
  </tr>
</table>

<h4>
Peptide-CGI
</h4>
<table border="1" cellspacing="0" cellpadding="2">
  <tr>
    <td>CVS repository:</td>
    <td>/p/devise/cvs at computer sciences</td>
  </tr>
  <tr>
    <td>Programming language:</td>
    <td>Java (most recently compiled with 1.6.0_07; generates 1.3
      class files)</td>
  </tr>
  <tr>
    <td>Development installation:</td>
    <td>http://devise.cs.wisc.edu/devise/bmrb_test/bmrb_select.html
      (user devise)
      (see Makefile.config.uw_cs_test)</td>
  </tr>
  <tr>
    <td>Quality assurance installation:</td>
    <td>http://devise.cs.wisc.edu/devise/bmrb/bmrb_select.html (user
      devise) (see Makefile.config.uw_cs_teal);
      <p>http://manatee.bmrb.wisc.edu/devise/peptide-cgi/bmrb_select.html
      (user web) (see Makefile.config.bmrb_manatee)</td>
  </tr>
  <tr>
    <td>Production installations:</td>
    <td>http://www.bmrb.wisc.edu/devise/peptide-cgi/bmrb_select.html
      (user web)
      (see pacu.bmrb.wisc.edu:/website/devise/peptide-cgi/peptide-cgi_*,
      Makefile.config.bmrb_pacu,
      piranha.bmrb.wisc.edu:/website/devise/peptide-cgi/peptide-cgi_*,
      Makefile.config.bmrb_piranha);
      <p>http://bmrb.protein.osaka-u.ac.jp/devise/peptide-cgi/bmrb_select.html
      (user webmaster)
      (see bmrbweb.protein.osaka-u.ac.jp:/bmrb/devise/peptide-cgi_*,
      Makefile.config.osaka2);
      <p>http://bmrb.cerm.unifi.it/devise/peptide-cgi/bmrb_select.html
      (user bmrb)
      (see bmrb.cerm.unifi.it:/bmrb/devise/peptide-cgi_*,
      Makefile.config.florence)
      </td>
  </tr>
</table>

<h4>
ChemShift
</h4>
<table border="1" cellspacing="0" cellpadding="2">
  <tr>
    <td>CVS repository:</td>
    <td>/cvsmain at BMRB</td>
  </tr>
  <tr>
    <td>Programming language:</td>
    <td>Java (most recently compiled with 1.5.0_11; generates 1.3
      class files)</td>
  </tr>
  <tr>
    <td>Development installation:</td>
    <td>various workspaces at BMRB</td>
  </tr>
  <tr>
    <td>Quality assurance installation:</td>
    <td>manatee.bmrb.wisc.edu:/website/devise/ChemShift/ChemShift_current
      (user web)</td>
  </tr>
  <tr>
    <td>Production installations:</td>
    <td>pacu.bmrb.wisc.edu:/website/devise/ChemShift (user web);
      <p>piranha.bmrb.wisc.edu:/website/devise/ChemShift (user webmaster);
      <p>bmrbweb.protein.osaka-u.ac.jp:/bmrb/devise_installed/ChemShift
        (user bmrb)</td>
  </tr>
</table>


<center><h3>
Bug Lists, Version Histories, etc.
</h3></center>

<h4>
DEVise
</h4>

<p>The bug list file is design_doc/Bugs.  This incorporates both DEVise
and JavaScreen bugs.  To-do lists are in design_doc/ToDo and
design_doc/ToDo2.</p>

<p>The DEVise version history is in doc/devise-version-history.</p>

<h4>
JavaScreen
</h4>

<p>As noted above, the DEVise bugs and to-do files also contain
information about JavaScreen, because many bugs and to-dos involve
changes to both sets of code.</p>

<p>The JavaScreen version history is in
Java/JavaScreen/html/javascreen_help.html</p>

<h4>
Peptide-CGI
</h4>

<p>The Peptide-CGI bug list is in peptide_cgi/Bugs, and the to-do
list is in peptide_cgi/ToDo.</p>

<p>The Peptide-CGI version history is in
peptide_cgi/pep-version-history.</p>

<h4>
ChemShift
</h4>

<p>The ChemShift bug list is in ChemShift/BMRB/chemShift/Bugs and the
to-do list is in ChemShift/BMRB/chemShift/ToDo.</p>

<p>The ChemShift version history is in
ChemShift/BMRB/chemShift/cs-version-history.</p>


<P class="datestamp">Last updated <!--#flastmod file="./overview.html" -->
<!-- $Id$ -->
</BODY>
</HTML>
