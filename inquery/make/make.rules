########################################################################### 
#                         Copyright (c) 1996                              #
# by Sovereign Hill Software, Inc., Amherst, Massachusetts, U.S.A.        #
#        (413-256-6916;   http://www.sovereign-hill.com)                  #
#                          All Rights Reserved.                           #
#                                                                         #
# The SOFTWARE was developed in part at the Center for Intelligent        #
# Information Retrieval (CIIR) at the University of Massachusetts at      #
# Amherst (For more information, contact 413-545-0463 or                  #
# http://ciir.cs.umass.edu).  The SOFTWARE was acquired by Sovereign      #
# Hill Software Inc. and is the property of Sovereign Hill Software.      #
# ACSIOM is authorized, under an agreement with Sovereign Hill Software,  #
# to license the SOFTWARE for non-commercial, non-revenue-producing       #
# prototyping and internal evaluation purposes only.                      #
#                                                                         #
# This SOFTWARE was developed in significant part with private funding.   #
# The INQUERY SOFTWARE is proprietary to Sovereign Hill Software and may  #
# not be distributed in whole or in part or used in any way without       #
# authorized permission in writing from Sovereign Hill Software.          #
# Possession, use, duplication or dissemination of the INQUERY SOFTWARE   #
# and media is authorized only pursuant to a valid written license from   #
# ACSIOM or Sovereign Hill Software, Inc.                                 #
#                                                                         #
# RESTRICTED RIGHTS LEGEND:  Use, duplication, or disclosure by the U.S.  #
# Government is subject to restrictions as set forth in subparagraph      #
# (c)(l)(ii) of the Rights in Technical Data and Computer Software clause #
# at DFARS 252.227-7013, or in FAR 52.227-19, as applicable.              #
########################################################################### 

#
#  This is a file of implicit rules for make.  It is designed to 
#  be included into other makefiles (using the include command).
#
SUFFIXES = .o .c .c~ .cc .cc~ .y .y~ .l .l~ .s .s~ .sh .sh~ .S .S~ .ln \
        .h .h~ .f .f~ .F .F~  .mod .mod~ .sym .def .def~ .p .p~ .r .r~ \
        .f90 .f90~ .ftn .ftn~ .cps .cps~ .C .C~ .Y .Y~ .L .L~

.SUFFIXES: $(SUFFIXES)


#
#  Define search paths for system files.

#
ARCH_INCLUDES=-I/usr/local/lib/gcc-include/ -I/usr/5include/ 
CSNETLIBS=-lsocket
ICNETLIBS=-lsocket -lnsl
ISNETLIBS=-lsocket
GENLIBS=-lgen

#  ***You may need to edit this to reflect the location of
# the tcl/tk package on your system;  change the "-L" path
# appropriately.
TCLLIB=-L/s/tcl/sun4x_55/lib -ltcl

#
#  Traditional makefile variables.
#  Configure as neccessary.
#

INQROOT=..
WORKDIR=$(INQROOT)/inq_work
LIBS=$(INQROOT)/lib

INSTALL_DIR=$(INQROOT)/bin
LIB_DIR=$(INQROOT)/lib

CC=gcc -O
LINK=$(CC)
CFLAGS= -fsigned-char -DINQ_ARCH_solaris  -L. -L$(INQROOT)/lib


ARCHIVE=ar vur
RANLIB=ar rs

VPATH=.:../h:../src:../obj
vpath %.o .:../obj
vpath %.c .:../src
vpath %.l ./:../src
vpath %.h ./:../h

INCLUDE_DIRS=-I- -I. -I../h -I../src $(ARCH_INCLUDES) -I/usr/local/include 

#
# Our scanners are built to run with flex.
#

LEX=/s/std/bin/flex
LEXFLAGS=-t -L -8


#
# FLEX allows easy redefinition of yylex internally in the scanner.
# BE SURE to do it.
#

.l.c :
	$(LEX) $(LEXFLAGS) -P$(*F)_ $< > $(*F).c
	@cp $(*F).c $(*F).c.save # for debugging purposes


#
#  Rule for creating a C file from a YACC specification.  This rule
#  enforces a naming convention of fu.y.c for C files and fu.y.h for
#  include files.
#

.y.c :
	yacc -vd $<
	echo "#define yylval " `echo $(*F) | rev | cut -d. -f2- | rev$(chop-y)`"_yylval" |tee $(*F).h  >$(*F).c
	cat y.tab.c | sed '/^#[ \t]*line/ d' \
	| awk  '/malloc/ {if (NR == 1) next;} {print}' >> $(*F).c
	cat y.tab.h  >> $(*F).h

#
# Rules to compile C files:  
#

#.c.o :
#	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDE_DIRS) -c $(<F)

%.o : %.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDE_DIRS) -c $<

%.c : %.l
	$(LEX) $(LEXFLAGS) -P$(*F)_ $< > $(*F).c
	@cp $(*F).c $(*F).c.save # for debugging purposes

