#! /bin/csh -f

#  ========================================================================
#  DEVise Data Visualization Software
#  (c) Copyright 2001-2013
#  By the DEVise Development Group
#  Madison, Wisconsin
#  All Rights Reserved.
#  ========================================================================
#
#  Under no circumstances is this software to be copied, distributed,
#  or altered in any way without prior permission from the DEVise
#  Development Group.

############################################################

#  Set the modes of the files generated by s2d (there doesn't seem
#  to be a way to do this directly in Java).

############################################################

#  $Id$

############################################################

if ($#argv == 2) then
  set name = $1
  set is_uvd = $2
else
  echo "Usage: set_modes <name> <is_uvd>"
  exit
endif

set outfile = "tmp/set_modes.out"
if (-e $outfile) then
  rm -f $outfile
endif
echo set_modes arguments: $* > $outfile

if ($is_uvd) then
  set sess_dir = "session_dir/.uvd"
  set data_dir = "data_dir/uvd"
  set html_dir = "html_dir/uvd/$name"
else
  set sess_dir = "session_dir"
  set data_dir = "data_dir"
  set html_dir = "html_dir/$name"
endif

# Make sure the session file directory has correct permissions, since
# Java creates directories with 644 permissions(!).
if (-e $sess_dir/$name) then
  # 777 here so we can run tests as different users and be able to
  # overwrite session files.
  chmod 777 $sess_dir/$name >>& $outfile
  chmod 666 $sess_dir/$name/$name* $data_dir/$name* >>& $outfile
endif
if (-e session_dir/vis_server/$name) then
  # 777 here so we can run tests as different users and be able to
  # overwrite session files.
  chmod 777 session_dir/vis_server/$name >>& $outfile
  chmod 666 session_dir/vis_server/$name/$name* \
    data_dir/vis_server/$name* >>& $outfile
endif
chmod 777 $html_dir >>& $outfile
chmod 666 $html_dir/* >>& $outfile
chmod 777 $html_dir"tmp"* >>& $outfile
echo $html_dir"tmp" >>& $outfile
chmod 666 $html_dir"tmp"*/* >>& $outfile
chmod 666 tmp/s2d.$name.warn >>& $outfile
chmod 666 tmp/s2d.$name.err >>& $outfile
chmod 666 tmp/s2d.log >>& $outfile
chmod 666 $outfile
