#! /bin/sh

############################################################

# Start the DEVised, creating a pid file to be used for checking
# and killing the DEVised.

# $Id$

############################################################

#
# Set output file name according to ID string (if any).
#
idStr=""
gotId=0
for arg in $*
do
  if [ $gotId = 1 ]
  then
    idStr=$arg
    gotId=0
  fi

  if [ $arg = "-id" ]
  then
    gotId=1
  fi
done

info=`ports+files $idStr`
outfile=`echo $info | cut -d' ' -f6`

#
# Fire up the DEVise executable, creating the appropriate pid file, and
# deleting the pid file when DEVise exits.
#
$DEVISE_EXEC $* -logLevel 4 -jscache 1 -fontkludge 0 >> $outfile 2>&1 &

host=`hostname`
pidfile="devised_pid:$idStr:$host:$!"
touch $pidfile
wait $!
rm $pidfile
